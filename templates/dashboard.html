<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>CHOITECH | Portal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <style>
    body {
      background-color: #e6f7ff;
      background-size: cover;
      background-repeat: no-repeat;
    }
    .navbar {
      background-color: #003366;
    }
    .navbar-brand {
      font-weight: bold;
      padding: 0.5rem 1rem;
      color: #ffffff !important;
    }
    .navbar-nav .nav-link {
      padding: 0.75rem 1.5rem;
      color: #ffffff;
      transition: color 0.3s ease;
    }
    .navbar-nav .nav-link:hover {
      color: #66ccff !important;
    }
    .navbar-nav .nav-link.active {
      color: #66ccff !important;
    }
    .navbar-toggler {
      border: none;
    }
    .form-control {
      border-radius: 0.25rem;
    }
    .toggle-buttons-container {
      display: none;
      flex-wrap: wrap;
    }
    .toggle-button {
      margin: 5px;
      font-size: 14px;
      padding: 5px 10px;
      transition: background-color 0.3s, box-shadow 0.3s, transform 0.3s;
    }
    .toggle-button:hover {
      background-color: #4CAF50;
      color: white;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      transform: scale(1.05);
    }
    .wrapper-button {
      transition: background-color 0.3s, transform 0.3s;
    }
    .wrapper-button:hover {
      background-color: #66ccff;
      transform: scale(1.05);
    }
    .p-1 {
      text-align: center;
      color: #FF5733;
      font-size: 20px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="nav-container">
    <nav class="navbar navbar-expand-lg">
      <div class="container-fluid">
        <a class="navbar-brand" href="/">Health Center</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav mx-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link active" aria-current="page" href="/dashboard">Home</a>
            </li>
            {% if 'email' in session %}
            <li class="nav-item">
              <a class="nav-link" href="/disease">Disease-Index</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/chatbot">
                <i class="fas fa-comment-dots"></i> <!-- Chat icon -->
                AskAI
              </a>
            </li>
            {% endif %}


            {% if 'email' not in session %}
            <li class="nav-item">
              <a class="nav-link" href="/about">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/developer">Developer</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/contact">Contact</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="/help">Help</a>
            </li>
            {% endif %}
            <!-- Dropdown menu for login and register -->
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                {% if 'email' in session %}
                  <span class="badge bg-success">Welcome, {{ session.username }}!</span>
                {% endif %}
              </a>
              <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                {% if 'email' not in session %}
                <li><a class="dropdown-item" href="/login">Login</a></li>
                <li><a class="dropdown-item" href="/register">Register</a></li>
                {% endif %}
              </ul>
            </li>
          </ul>
          {% if 'email' in session %}
          <ul class="navbar-nav ms-auto mb-2 mb-lg-0">
            <li class="nav-item">
              <a class="nav-link" href="/logout" style="color:red">Logout</a>
            </li>
          </ul>
          {% endif %}
        </div>
      </div>
    </nav>
  </div>
  
{% if 'email' in session %}
<div class="container-fluid mt-4 my-4" style="background-color:transparent; color:black; border-radius:15px; padding:40px;">
  <div class="row">
    <!-- Slider on the left -->
    <div class="col-lg-6">
      <div id="health-slider" style="height: 75vh; padding: 40px 0; background-color:#ccf2ff; border-radius:15px;">
        <!-- Carousel Slider -->
        <div class="carousel slide" data-bs-ride="carousel" id="carouselExampleControls">
          <div class="carousel-inner">
            <!-- First Slide with Image and Text -->
            <div class="carousel-item active">
              <img src="{{ url_for('static', filename='hi.jpeg') }}" class="d-block w-100" style="height: 100%; object-fit: contain;" alt="Stay Hydrated">
              <div class="carousel-caption d-none d-md-block">
                <p class="text-center" style="color: #f6f5f8; font-weight: bold;">"Stay hydrated for better health!"</p>
              </div>
            </div>

            <!-- Second Slide with Image and Text -->
            <div class="carousel-item">
              <img src="{{ url_for('static', filename='stay.jpg') }}" class="d-block w-100" style="height: 100%; object-fit: contain;" alt="Exercise">
              <div class="carousel-caption d-none d-md-block">
                <p class="text-center" style="color: black;">"Regular exercise can reduce stress."</p>
              </div>
            </div>

            <!-- Third Slide with Image and Text -->
            <div class="carousel-item">
              <img src="{{ url_for('static', filename='5200065.jpg') }}" class="d-block w-100" style="height: 100%; object-fit: contain;" alt="Healthy Eating">
              <div class="carousel-caption d-none d-md-block">
                <p class="text-center">"Healthy eating leads to a happy life."</p>
              </div>
            </div>
          </div>

          <!-- Carousel Controls -->
          <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Previous</span>
          </button>
          <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleControls" data-bs-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="visually-hidden">Next</span>
          </button>
        </div>
      </div>
    </div>

    <!-- Form on the right -->
    <div class="col-lg-6">
      <form action="/predict" method="POST">
        <label for="symptoms">Type or record your Symptoms</label><br>
        <div class="input-group">
          <input type="text" class="form-control" id="symptoms" name="symptoms" placeholder="Type or record your symptoms">
          <button type="button" id="start-record-btn" class="btn btn-secondary"><i class="bi bi-mic-fill"></i> ðŸŽ¤</button>
          <button type="submit" class="btn btn-primary wrapper-button">Predict</button>
        </div>
      </form>
      <div class="text-center mt-3">
        <center>
          <button id="toggleButtons" class="btn btn-primary" style="width: 20%; padding: 10px; margin-bottom: 15px;">Predictions</button>
        </center>
        <div id="predictionButtons" style="display: none;">
          <button class="btn btn-success toggle-button" data-bs-toggle="modal" data-bs-target="#diseaseModal">View Disease</button>
          <button class="btn btn-info toggle-button" data-bs-toggle="modal" data-bs-target="#descriptionModal">View Description</button>
          <button class="btn btn-danger toggle-button" data-bs-toggle="modal" data-bs-target="#precautionModal">View Precautions</button>
          <button class="btn btn-warning toggle-button" data-bs-toggle="modal" data-bs-target="#dietModal">View Diets</button>
          <button class="btn btn-secondary toggle-button" data-bs-toggle="modal" data-bs-target="#workoutModal">View Workouts</button>
        </div>
      </div>
    </div>
  </div>
</div>

{% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    <div class="row justify-content-center">
      <div class="col-lg-6">
        {% for category, message in messages %}
          <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
            <p style="color:green; font-size:20px;">{{ message }}</p></p>
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      </div>
    </div>
  {% endif %}
{% endwith %}
</div>
{% endif %}

{% if 'email' not in session %}
<div>
  <p class="text-center, p-20">You are loggedOut to access the Services, please consider to Login again!</p>
</div>
{% endif %}


<!--Disease Modal -->
<div class="modal fade" id="diseaseModal" tabindex="-1" aria-labelledby="diseaseModallabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="background-color:green; color:white;">
        <h5 class="modal-title" id="diseaseModallabel">Disease</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" style="background-color:dark;">
        <p>{{ predicted_disease }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>
<!--Description Modal-->
<div class="modal fade" id="descriptionModal" tabindex="-1" aria-labelledby="descriptionModallabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="background-color:green; color:white;">
        <h5 class="modal-title" id="descriptionModallabel">Description</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" style="background-color:dark;">
        <p>{{ dis_des }}</p>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!--Medication Modal -->
<div class="modal fade" id="medicationModal" tabindex="-1" aria-labelledby="medicationModallabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="background-color:green; color:white;">
        <h5 class="modal-title" id="medicationModallabel">Medication</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" style="background-color:dark;">
        <ul>
          {% for med in dis_med %}
          <li>{{ med.strip("[]' ") }}</li> <!-- Remove square brackets and single quotes -->
          {% endfor %}
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!--Precaution Modal -->
<div class="modal fade" id="precautionModal" tabindex="-1" aria-labelledby="precautionModallabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="background-color:green; color:white;">
        <h5 class="modal-title" id="precautionModallabel">Precaution</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" style="background-color:dark;">
        <ul>
          {% for pre in dis_pre %}
          <li>{{ pre }}</li>
          {% endfor %}
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!--Diet Modal -->
<div class="modal fade" id="dietModal" tabindex="-1" aria-labelledby="dietModallabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="background-color:green; color:white;">
        <h5 class="modal-title" id="dietModallabel">Diet</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" style="background-color:dark;">
        <ul>
          {% for diet in dis_die %}
          <li>{{ diet.strip("[]' ") }}</li> <!-- Remove square brackets and single quotes -->
          {% endfor %}
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<!--Workout Modal -->
<div class="modal fade" id="workoutModal" tabindex="-1" aria-labelledby="workoutModallabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header" style="background-color:green; color:white;">
        <h5 class="modal-title" id="workoutModallabel">Workout</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" style="background-color:dark;">
        <ul>
          {% for workout in dis_wrkout %}
          <li>{{ workout }}</li>
          {% endfor %}
        </ul>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>
// JavaScript to hide wrapper and toggle buttons on page refresh
window.onload = function() {
  var container = document.querySelector(".toggle-buttons-container");
  container.style.display = "none";
};

// JavaScript to toggle the visibility of the toggle buttons container
document.getElementById("toggleButtons").addEventListener("click", function() {
  var container = document.querySelector(".toggle-buttons-container");
  if (container.style.display === "none") {
    container.style.display = "flex";
  } else {
    container.style.display = "none";
  }
});

// JavaScript to toggle the visibility of the prediction buttons
  document.getElementById("toggleButtons").addEventListener("click", function() {
    var predictionButtons = document.getElementById("predictionButtons");
    if (predictionButtons.style.display === "none") {
      predictionButtons.style.display = "block";
    } else {
      predictionButtons.style.display = "none";
    }
  });
</script>
<script>
 document.addEventListener("DOMContentLoaded", function () {
  const startRecordBtn = document.getElementById("start-record-btn");
  const symptomsInput = document.getElementById("symptoms");
  const predictBtn = document.getElementById("predict-btn");
  const recordingBtn = document.getElementById("recording-btn");
  let recognition; // Declare recognition variable outside the scope
  let firstPhraseRecorded = false; // Track if the first phrase has been recorded

  // Check for SpeechRecognition API support
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

  if (SpeechRecognition) {
    recognition = new SpeechRecognition();

    // This runs when the speech recognition service starts
    recognition.onstart = function() {
      console.log("Speech recognition service has started");
      startRecordBtn.innerText = "ðŸŽ¤ Recording...";
    };

    // This runs when the speech recognition service returns result
    recognition.onresult = function(event) {
      const transcript = event.results[event.results.length - 1][0].transcript;
      console.log("Speech recognition result received:", transcript);
      // Remove the period from the end of the transcript
      let trimmedTranscript = transcript.trim();
      if (trimmedTranscript.endsWith('.')) {
        trimmedTranscript = trimmedTranscript.slice(0, -1); // Remove the last character (period)
      }
      // Handle voice commands
      if (trimmedTranscript.toLowerCase() === "delete") {
        deleteLastPhrase();
      } else if (trimmedTranscript.toLowerCase() === "clear") {
        clearAllPhrases();
      } else if (trimmedTranscript.toLowerCase() === "stop") {
        stopRecording();
      } else if (trimmedTranscript.toLowerCase() === "predict") {
        triggerPredictButton();
      } else {
        // Append the transcript to the existing value with comma at the beginning if not the first phrase
        if (firstPhraseRecorded) {
          symptomsInput.value += ", ";
        } else {
          firstPhraseRecorded = true; // Set flag to true after recording the first phrase
        }
        symptomsInput.value += trimmedTranscript;
      }
    };

    // Handle errors
    recognition.onerror = function(event) {
      console.error("Speech recognition error:", event.error);
      startRecordBtn.innerText = "ðŸŽ¤ Start Recording";
    };

    // Start the speech recognition
    startRecordBtn.addEventListener("click", function() {
      recognition.start();
    });

    // This runs when the speech recognition service ends
    recognition.onend = function() {
      console.log("Speech recognition service has stopped");
      startRecordBtn.innerText = "ðŸŽ¤ Start Recording";
      recognition.start(); // Restart the recognition service immediately after it ends
    };
  } else {
    console.error("SpeechRecognition API is not supported in this browser.");
    startRecordBtn.disabled = true;
    startRecordBtn.innerText = "ðŸŽ¤ Not Supported";
  }

  // Function to delete the last phrase
  function deleteLastPhrase() {
    const phrases = symptomsInput.value.split(", ");
    if (phrases.length > 1) {
      phrases.pop(); // Remove the last phrase
      symptomsInput.value = phrases.join(", ");
    } else {
      symptomsInput.value = ""; // Clear input if only one phrase is present
      firstPhraseRecorded = false; // Reset the flag
    }
  }

  // Function to clear all phrases
  function clearAllPhrases() {
    symptomsInput.value = ""; // Clear input
    firstPhraseRecorded = false; // Reset the flag
  }

  // Function to stop recording
  function stopRecording() {
    recognition.stop(); // Stop the recognition service
    startRecordBtn.innerText = "ðŸŽ¤ Start Recording"; // Change button text
    // Perform additional actions if needed
    // For example, if you want to stop the recording button animation:
    recordingBtn.classList.remove("recording-animation");
  }

  // Function to trigger the predict button
  function triggerPredictButton() {
    predictBtn.click(); // Click the predict button
    // Perform additional actions if needed
  }
});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
